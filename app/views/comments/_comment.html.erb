<section class='comments_thread'>

  <% nested = nested_comments_for( comment, from: @comments ) %>

  <%= div_for comment do %>
    <%= render 'controls', comment: comment, children_count: nested.size %>
    <div class='metadata'>
      <span class='user_name'><%= comment.user.name.titleize %></span>
      <span class='created_at'><%= created_at(comment) %></span>
    </div>

    <section><%= comment.body_as_html.html_safe %></section>
  <% end %>

  <%= render nested %>
</section>